<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¹é«”ä¸­æ–‡ AI å­¸ç¿’å·¥å…·</title>
    <script src="https://unpkg.com/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pinyin-pro@3.18.3/dist/index.js"></script>

    <style>
        :root {
            --primary-color: #4a7c59; /* æ•™ç§‘æ›¸ç¶  */
            --accent-color: #d97706;  /* æ³¨éŸ³æ©˜ */
            --bg-color: #fdfbf7;      /* ç±³é»ƒè­·çœ¼ç´™å¼µè‰² */
        }

        body { 
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif; 
            background-color: var(--bg-color); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px;
            color: #334155;
        }

        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 24px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.05); 
            text-align: center; 
            max-width: 450px; 
            width: 100%; 
            border: 1px solid #e2e8f0;
        }

        h1 { color: var(--primary-color); font-size: 26px; margin-bottom: 25px; letter-spacing: 2px; }

        .input-group { margin-bottom: 25px; display: flex; justify-content: center; gap: 12px; }

        input { 
            font-size: 24px; 
            padding: 12px; 
            width: 90px; 
            text-align: center; 
            border: 2px solid #e2e8f0; 
            border-radius: 16px; 
            outline: none;
            transition: all 0.3s;
        }
        input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(74, 124, 89, 0.1); }

        button { 
            padding: 12px 24px; 
            font-size: 18px; 
            cursor: pointer; 
            background: var(--primary-color); 
            color: white; 
            border: none; 
            border-radius: 16px; 
            font-weight: bold;
            transition: transform 0.2s, background 0.3s;
        }
        button:hover { background: #3d664a; transform: translateY(-2px); }
        button:active { transform: translateY(0); }

        #result-area { display: none; flex-direction: column; align-items: center; }

        /* æ³¨éŸ³å€åŸŸ */
        .zhuyin-wrapper {
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .zhuyin-text { 
            font-size: 56px; 
            color: var(--accent-color); 
            font-weight: bold; 
            font-family: "BiauKai", "æ¨™æ¥·é«”", serif; 
            display: block;
            line-height: 1.2;
        }
        .hint-text { font-size: 13px; color: #94a3b8; margin-bottom: 10px; }

        /* ç”°å­—æ ¼ */
        #character-target { 
            width: 280px; 
            height: 280px; 
            border: 4px solid #f1f5f9; 
            background: #fff; 
            border-radius: 20px;
            overflow: hidden;
        }

        .controls { display: flex; gap: 12px; margin-top: 25px; width: 100%; }
        .btn-secondary { background: #64748b; flex: 1; }
        .btn-quiz { background: #059669; flex: 1; }

        .status-msg { margin-top: 15px; font-weight: bold; font-size: 15px; }
        .loading { color: var(--primary-color); }
        .error { color: #ef4444; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ç¹é«”ä¸­æ–‡ AI ç­†ç•«</h1>
        
        <div class="input-group">
            <input type="text" id="charInput" maxlength="1" placeholder="è¼¸å…¥å­—">
            <button onclick="queryCharacter()">é–‹å§‹</button>
        </div>
        
        <div id="statusMsg" class="status-msg"></div>

        <div id="result-area">
            <div class="zhuyin-wrapper" onclick="speakText()">
                <div id="zhuyinDisplay" class="zhuyin-text"></div>
                <div class="hint-text">ğŸ”ˆ é»æ“Šè½ç™¼éŸ³</div>
            </div>
            
            <div id="character-target"></div>
            
            <div class="controls">
                <button class="btn-secondary" onclick="writer.animateCharacter()">é‡æ’­</button>
                <button id="quizBtn" class="btn-quiz" onclick="toggleQuiz()">æ‰‹å¯«æ¸¬é©—</button>
            </div>
        </div>
    </div>

    <script>
        let writer = null;
        let isQuiz = false;
        let currentChar = "";

        // èªéŸ³æœ—è®€åŠŸèƒ½
        function speakText() {
            if (!currentChar) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(currentChar);
            utterance.lang = 'zh-TW';
            utterance.rate = 0.8;
            window.speechSynthesis.speak(utterance);
        }

        async function queryCharacter() {
            const char = document.getElementById('charInput').value.trim();
            const statusMsg = document.getElementById('statusMsg');
            const resultArea = document.getElementById('result-area');
            const target = document.getElementById('character-target');
            const zhuyinDisplay = document.getElementById('zhuyinDisplay');

            if (!char || !/[\u4e00-\u9fa5]/.test(char)) {
                statusMsg.className = "status-msg error";
                statusMsg.innerText = "è«‹è¼¸å…¥å–®å€‹ä¸­æ–‡å­—";
                return;
            }

            currentChar = char;
            statusMsg.className = "status-msg loading";
            statusMsg.innerText = "ğŸ” æœå°‹ä¸­...";
            statusMsg.style.display = "block";
            resultArea.style.display = "none";
            target.innerHTML = '';

            // 1. å–å¾—æ³¨éŸ³ (ä½¿ç”¨ pinyin-pro çš„æœ€æ–°èª¿ç”¨æ–¹å¼)
            try {
                if (typeof pinyinPro !== 'undefined') {
                    // ç²å–æ³¨éŸ³ä¸¦éæ¿¾æ‰å¯èƒ½å‡ºç¾çš„ç©ºæ ¼
                    const rawZhuyin = pinyinPro.pinyin(char, { type: 'zhuyin' });
                    zhuyinDisplay.innerText = rawZhuyin.replace(/\s+/g, '');
                } else {
                    zhuyinDisplay.innerText = "";
                }
            } catch (e) {
                console.error("æ³¨éŸ³è®€å–å¤±æ•—", e);
            }

            // 2. å»ºç«‹ç­†åŠƒå‹•ç•«
            writer = HanziWriter.create('character-target', char, {
                width: 280,
                height: 280,
                padding: 15,
                showOutline: true,
                strokeColor: '#334155',
                outlineColor: '#f1f5f9',
                charDataLoader: async function(charToLoad, onComplete) {
                    const urls = [
                        `https://cdn.jsdelivr.net/npm/hanzi-writer-data-traditional@2/${encodeURIComponent(charToLoad)}.json`,
                        `https://cdn.jsdelivr.net/npm/hanzi-writer-data@2/${encodeURIComponent(charToLoad)}.json`
                    ];
                    
                    for (const url of urls) {
                        try {
                            const res = await fetch(url);
                            if (res.ok) {
                                const data = await res.json();
                                onComplete(data);
                                // æˆåŠŸè¼‰å…¥å¾Œçš„å‹•ä½œ
                                statusMsg.style.display = "none";
                                resultArea.style.display = "flex";
                                writer.animateCharacter();
                                speakText();
                                return;
                            }
                        } catch (e) {}
                    }
                    statusMsg.className = "status-msg error";
                    statusMsg.innerText = "æ‰¾ä¸åˆ°ç­†ç•«è³‡æ–™";
                }
            });
        }

        function toggleQuiz() {
            if (!writer) return;
            isQuiz = !isQuiz;
            const btn = document.getElementById('quizBtn');
            if (isQuiz) {
                writer.quiz();
                btn.innerText = "åœæ­¢æ¸¬é©—";
                btn.style.background = "#ef4444";
            } else {
                writer.cancelQuiz();
                writer.animateCharacter();
                btn.innerText = "æ‰‹å¯«æ¸¬é©—";
                btn.style.background = "#059669";
            }
        }
    </script>
</body>
</html>
